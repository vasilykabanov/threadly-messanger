threadly-chat.ru {
    # WebSocket для чата
    @websocket {
        path /api/chat/ws*
    }
    handle @websocket {
        uri strip_prefix /api/chat
        reverse_proxy threadly-chat:8080
    }

    # Auth API
    handle_path /api/auth/* {
        reverse_proxy threadly-auth:8081
    }

    # Chat API
    handle_path /api/chat/* {
        reverse_proxy threadly-chat:8080
    }

    # Frontend (всё остальное)
    handle {
        reverse_proxy threadly-frontend:80
    }
}
