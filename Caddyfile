threadly-chat.ru {
    # Auth API
    handle_path /api/auth/* {
        reverse_proxy threadly-auth:8081
    }

    # WebSocket и Chat API — всё идёт на chat сервис
    handle_path /api/chat/* {
        reverse_proxy threadly-chat:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Frontend (всё остальное)
    handle {
        reverse_proxy threadly-frontend:80
    }
}
